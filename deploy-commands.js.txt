import { Client, GatewayIntentBits } from "discord.js";
import fs from "fs";
import path from "path";
import { fileURLToPath } from "url";

import { ActionSystem } from "./src/systems/actionSystem.js";
import { RankingSystem } from "./src/systems/rankingSystem.js";
import Logger from "./src/systems/logger.js";

const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);

// ===== CLIENTE =====
const client = new Client({
  intents: [
    GatewayIntentBits.Guilds,
    GatewayIntentBits.GuildMembers,
    GatewayIntentBits.GuildMessages
  ]
});

// ===== SISTEMAS =====
client.acoes = new ActionSystem();
client.ranking = new RankingSystem();
client.logger = new Logger(client);

// ===== EVENTOS =====
const eventsPath = path.join(__dirname, "src", "events");
for (const file of fs.readdirSync(eventsPath)) {
  const event = await import(`./src/events/${file}`);
  client.on(event.name, (...args) => event.execute(...args, client));
}

// ===== LOGIN =====
client.login(process.env.TOKEN);

client.once("ready", () => {
  console.log(`âœ… Bot online como ${client.user.tag}`);
});
